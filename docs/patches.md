## Overview

We use Electron scripts to apply patches to Chromium and other repositories.
Patches for different repositories have to be placed in different folders
because those Electron scripts expect them to be organized like that.
We additionally split patches into several groups to make build customization
more flexible. So the final folder structure looks like this:

```
patches/
  group_one/
    config.json
    project_one/
      .patches
      change_one.patch
      change_two.patch
    project_two/
      .patches
      another_patch.patch
  group_two/
    config.json
    project_one/
      .patches
      yet_another_patch.patch
```

## File Types

### *.patch

Those are generated by [git-format-patch](https://git-scm.com/docs/git-format-patch) command.  
Please use the `git-export-patches` script from Electron's `script/` folder to (re-)generate a list of patches.

On Windows, make sure git **autocrlf** option is disabled. If it is enabled and you try to 
generate a patch file, you'll get a patch that completely rewrites the whole file.
```
$ git config --global core.autocrlf false
```

### .patches

An ordered list of patches for a repo. Can only contains paths to files in the same folder.  
It will be (re-)generated for you if you use the aforementioned `git-export-patches` script.

### config.json

Is a mapping of paths to folders with patches to paths to repositories those patches have to be applied to, e.g.
```
{
  "src/i/have/patches": "src/i/am/a/repository"
}
```
All paths must start with "src/" because it's a project root for gclient.  
These files are written manually.

## Patches Groups

### `backports/`

Backports of security-related or other important fixes in Electron and/or Chromium.

### `internal_build/`

Contains patches for **all** internal builds of Electron.
Those are needed only to make it possible to build Electron internally.

### `customization/`

Contains patches that add Microsoft-internal features for various Microsoft products that require customization.  
See also the ["How To: Patch FFmpeg" article](how_to/patch_ffmpeg.md) for more information.

## Customization Patches

Those add Microsoft-specific features to Electron. Typically one patch adds one feature.  
Despite the fact that different Microsoft products need different sets of features all patches are always applied,  
and the list of enabled features is controlled by build flags.  
This approach requires few things to keep in mind while writing patches:
- every change in a patch has to be guarded by a build flag
- when a build flag is disabled the original behaviour has to be preserved
- all build flags have to be disabled by default
